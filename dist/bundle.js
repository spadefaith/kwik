var Kwik=(()=>{var _=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var E=Object.getOwnPropertyNames;var T=Object.prototype.hasOwnProperty;var L=(e,t)=>{for(var s in t)_(e,s,{get:t[s],enumerable:!0})},$=(e,t,s,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of E(t))!T.call(e,i)&&i!==s&&_(e,i,{get:()=>t[i],enumerable:!(r=S(t,i))||r.enumerable});return e};var v=e=>$(_({},"__esModule",{value:!0}),e);var M={};L(M,{Blueprint:()=>g,Component:()=>C,createSignal:()=>f});var k=(e,t)=>{let s="//comment()",r=[],i=document.evaluate(s,e,null,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);for(let n=0,a=i.snapshotLength;n<a;++n){let c=i.snapshotItem(n);t?t==c.nodeValue&&r.push(c):r.push(c)}return r},h=e=>new DOMParser().parseFromString(e,"text/html").body;var b=class{renderFunction;component;jsx;events;signals;constructor(t){this.component=t;let s=t.template;this.renderFunction=null,typeof s=="function"?(this.renderFunction=s,this.jsx=s()):this.jsx=s,this.events=[],this.signals=[]}toHtml(){let t=this.jsx,s=h(t);return this.component.events.forEach(r=>{let{type:i,id:n,handler:a}=r,c=s.querySelector(`[data-event=click-${n}]`);c&&c.addEventListener(i,d=>{a(d)})}),{str:t,html:s}}};var H=(e,t)=>{let s=e.id,r=e.name,i=e.attributes,n=e.template,a=new b(e),c=null,d="";return customElements.get(r)||customElements.define(r,class extends HTMLElement{static observedAttributes=[...i,"key"];constructor(){super()}connectedCallback(){if(typeof n=="function"){let{str:l,html:m}=a.toHtml();c=m}d=this.innerHTML,this.innerHTML="";let o=c.childNodes;[...h(d).childNodes,...o].forEach(l=>{this.appendChild(l)}),t.broadcast("rendered",this)}disconnectedCallback(){t.broadcast("destroy",this)}adoptedCallback(){t.broadcast("adopted",this)}attributeChangedCallback(o,l,m){t.broadcast("change",{name:o,oldValue:l,newValue:m})}}),customElements.get(r)},x=H;var u=()=>`a${crypto.randomUUID().replaceAll("-","")}a`;function f(e){let t=e,s=[];function r(){for(let i of s)i(t)}return{id:u(),get value(){return t},set value(i){t=i,r()},subscribe:i=>{s.push(i)},toString:()=>t.toString(),get isSignal(){return!0}}}var p=class{constructor(t){this.array=t;this.array=t}get data(){return Array.isArray(this.array)?this:this.array}each(t){return this.array.map(t).join("")}};var y=class{subscriber;constructor(){this.subscriber={destroy:[],rendered:[],change:[],adopted:[]}}destroy(t){this.subscriber.destroy.push(t)}rendered(t){this.subscriber.rendered.push(t)}change(t){this.subscriber.change.push(t)}adopted(t){this.subscriber.adopted.push(t)}broadcast(t,s){this.subscriber[t]&&this.subscriber[t].forEach(r=>{r(s)})}clean(t){t&&this.subscriber[t]?this.subscriber[t]=[]:this.subscriber={destroy:[],rendered:[],change:[],adopted:[]}}};var I=class{name;id;attributes;template;callback;custom;componentCallback;componentDisconnectCallback;signals;styles;events;lifecycle;constructor(e){this.callback=e,this.id=u(),this.name=`x-${this.id}`,this.attributes=[],this.template={},this.signals={},this.styles={},this.events=[],this.lifecycle=new y,this._initLifecycle(),this._createTemplate(),this._createCustom()}_initLifecycle(){this.lifecycle.rendered(e=>{Object.keys(this.styles).forEach(t=>{let s=this.styles[t],r=document.querySelector(`[data-style=${t}]`);r&&Object.keys(s).forEach(i=>{r.style[i]=s[i]})})}),this.lifecycle.change(({name:e,oldValue:t,newValue:s})=>{this.signals[e]&&this.signals[e].forEach(r=>{t!=s&&(r.value=s)})})}_createTemplate(){let e=this.callback({node:this._nodeCallback.bind(this),render:this._renderCallback.bind(this),attr:this._attrCallback.bind(this),events:this._eventsCallback.bind(this),connectedCallback:this._connectedCallback.bind(this),props:this._propsCallback.bind(this),style:this._styleCallback.bind(this)});this.template=e}_styleCallback(e){let t=u();return this.styles[t]=e,Object.keys(e).forEach(s=>{let r=e[s];r.isSignal&&(this._registerSignal(s,r),r.subscribe(i=>{let n=document.querySelector(`[data-style=${t}]`);n&&(n.style[s]=i)}))}),`data-style=${t}`}_propsCallback(e,t){this.attributes.push(e);let s=f(t);return this._registerSignal(e,s),s}_connectedCallback(e){this.lifecycle.rendered(e),this.lifecycle.destroy(()=>e())}_eventsCallback(e){return Object.keys(e).map(t=>{let s=e[t],r=u();return this.events.push({id:r,type:t,handler:s}),`data-event=${t}-${r}`}).join(" ")}_attrCallback(e,t){return t.isSignal&&(this._registerSignal(t.id,t),t.subscribe(s=>{})),`${e}=${t}`}_nodeCallback(e){return this._registerSignal(e.id,e),e.subscribe(t=>{let s=e.id,r=document.querySelector(this.name);r&&setTimeout(()=>{let i=k(r,`node ${s}`);i.length&&i.forEach(n=>{let a=n.nextSibling;a.nodeType==3&&(a.nodeValue[0]==" "?a.nodeValue=` ${e}`:a.nodeValue=e)})})}),`<!--node ${e.id}--> ${e}`}_renderCallback(e,t,s={}){let r=typeof t=="string",i=typeof t=="function";return s.replace==null&&(s.replace=!!r),e.subscribe(n=>{Array.isArray(n)&&(n=new p(n).data);let a=e.id,c=document.querySelector(this.name);c&&setTimeout(()=>{let d=k(c,`render ${a}`);d.length&&d.forEach(o=>{let l=null;if(r)if(s.renderer)l=s.renderer.render(t,{list:n});else throw new Error("renderer is required");else i&&(l=t(n));if(o.isInitialized||(o.isInitialized=!0),o.isInitialized&&s.replace&&o.nextSibling.remove(),!l)return;let m=h(l);o.parentElement.insertBefore(m.firstChild,o.nextSibling)})})}),`<!--render ${e.id}-->`}_createCustom(){this.custom=x(this,this.lifecycle)}_registerSignal(e,t){this.signals[e]||(this.signals[e]=[]),this.signals[e].push(t)}},C=I;var g=class{callback;current;constructor(t){this.callback=t,this.current=null}build(){return this.current=new C(this.callback),this.current.name}toString(){return this.build()}close(){return this.current.name}};return v(M);})();
//# sourceMappingURL=bundle.js.map
